<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
</head>
<body>

    <script>
    
    var score = 9999;
    var scoreText;
    var enemiesLeft = "xx";
    var enemiesText;
    
    function bpress (){
        score -= 10;
        scoreText.setText('Time: ' + score);
        console.log(score)
        if(score <= 0){
            scoreText.setText('Click Screen: ' + score);
        }
    }
    function chealth(xmod,img,ymod = 8){
        health.create(256+xmod,ymod,img);
    }
    function cbar(xmod,ymod,img){
        platforms.create(256+xmod,128+ymod,img);
    }
    
    
    var sceneOne = new Phaser.Class({
        Extends: Phaser.Scene,
        initialize:
        function SceneOne(){
            Phaser.Scene.call(this,{key: 'sceneOne'});
        },
        
        
    
        preload: function (){
            
            
            //this.load.image('red', 'http://labs.phaser.io/assets/particles/red.png');
            this.load.image('map1', 'tempmap1.png');
            this.load.image('fence1','fence 1.png');
            this.load.image('fence2','fence 2.png');
            this.load.image('fence3','fence 3.png');
            this.load.image('fence4','fence 4.png');
            this.load.image('fencetl','fence tl.png');
            this.load.image('fencetr','fence tr.png');
            this.load.image('fencebr','fence bl.png');
            this.load.image('fencebl','fence br.png');
            this.load.image('fheart','heart.png');
            //this.load.image('ground', 'platform.png');
            
            this.load.spritesheet('dude', 
                './tempspritesheet.png',
                { frameWidth: 16, frameHeight: 16 }
                );
            cursors = this.input.keyboard.createCursorKeys();
        
        },
        create: function (){   
            /*this.input.on('pointerdown', function (event) {

            if(score <= 0){
                console.log("thing");
                this.scene.start('sceneTwo'); 
            };

            

        }, this);*/
            this.add.image(256, 128, 'map1');
            scoreText = this.add.text(24, 0, 'Time: 9999', { fontSize: '16px', fill: '#FFF' });
            enemiesText = this.add.text(512-16*8, 0, 'Enemies: 24', { fontSize: '16px', fill: '#FFF' });
        

            //var particles = this.add.particles('red');

            /*var emitter = particles.createEmitter({
                speed: 100,
                scale: { start: 1, end: 0 },
                blendMode: 'ADD'
            });*/

            

            
            health = this.physics.add.staticGroup();
            var i = -3
            while(i<5){
                chealth(-8+16*i,'fheart');
                i += 1;
            }
            
            
            platforms = this.physics.add.staticGroup();
            cbar(-40, -24, 'fence1');
            cbar(-40,-40, 'fencetl');
            cbar(-24, -40, 'fence4');
           
            cbar(40,-24, 'fence2')
            cbar(40, -40, 'fencetr');
            cbar(24, -40, 'fence4');
            
            cbar(-40, 24, 'fence1');
            cbar(-40, 40, 'fencebr');
            cbar(-24, 40, 'fence3');
            
            cbar(40,24, 'fence2');
            cbar(40, 40, 'fencebl');
            cbar(24, 40, 'fence3');
            
            player = this.physics.add.sprite(360, 168, 'dude');
            
            player.setBounce(0.2);
            player.setCollideWorldBounds(true);
            //emitter.startFollow(player);

            this.anims.create({
                key: 'left',
                frames: this.anims.generateFrameNumbers('dude', { start: 4, end: 5 }),
                frameRate: 10,
                repeat: -1
            });

            this.anims.create({
                key: 'turn',
                frames: [ { key: 'dude', frame: 1 } ],
                frameRate: 10
            });

            this.anims.create({
                key: 'right',
                frames: this.anims.generateFrameNumbers('dude', { start: 6, end: 7 }),
                frameRate: 10,
                repeat: -1
            });
            this.anims.create({
                key: 'up',
                frames:  this.anims.generateFrameNumbers('dude', { start: 2, end: 3}),
                frameRate: 10
            });
            this.anims.create({
                key: 'down',
                frames:  this.anims.generateFrameNumbers('dude', { start: 0, end: 1 }) ,
                frameRate: 10
            });

            this.physics.add.collider(player, platforms);
        
        },
        update: function (){   
            if((cursors.left.isDown && cursors.right.isUp) && (cursors.up.isDown && cursors.down.isUp)){
                player.setVelocityX(-100);
                player.setVelocityY(-100);
                player.anims.play('left', true);
            }
            else if((cursors.left.isUp && cursors.right.isDown) && (cursors.up.isDown && cursors.down.isUp)){
                player.setVelocityX(100);
                player.setVelocityY(-100);
                player.anims.play('right', true);
            }
            /*else if((cursors.left.isDown && cursors.right.isDown) && (cursors.up.isDown && cursors.down.isUp)){
                player.setVelocityX(0);
                player.setVelocityY(-100);
                player.anims.play('right', true);
            }*/
            else if((cursors.left.isDown && cursors.right.isUp) && (cursors.up.isUp && cursors.down.isDown)){
                player.setVelocityX(-100);
                player.setVelocityY(100);
                player.anims.play('left', true);
            }
            else if((cursors.left.isUp && cursors.right.isDown) && (cursors.up.isUp && cursors.down.isDown)){
                player.setVelocityX(100);
                player.setVelocityY(100);
                player.anims.play('right', true);
            }
            else if (cursors.left.isDown){
                player.setVelocityX(-100);
                //bpress();

                player.anims.play('left', true);
            }
            else if (cursors.right.isDown){
                player.setVelocityX(100);
                //bpress();
                player.anims.play('right', true);
            }

            else if (cursors.up.isDown)
            {
                player.setVelocityY(-100);
                //bpress(player);
                player.anims.play('up', true);
            }
            else if (cursors.down.isDown)
            {
                player.setVelocityY(100);
                //bpress(player);
                player.anims.play('down', true);
            }
            else {
                player.setVelocityY(0);
                player.setVelocityX(0)
            }
        }
    });
    
    var sceneTwo = new Phaser.Class({
        Extends: Phaser.Scene,
        initialize:
        function sceneTwo(){
            Phaser.Scene.call(this,{key:'sceneTwo'});
        },
        preload: function(){
            this.load.image('bg', 'ladyelaine.png');
            
        },
        create: function(){
            this.add.image(400, 300, 'bg').setScale(.25);
            scoreText = this.add.text(16, 16, 'Jump: 9999', { fontSize: '32px', fill: '#183' });
            gametext = this.add.text(50, 300, 'the game is over there is nothing left', { fontSize: '32px', fill: '#30a' });
        },
        update: function(){
            bpress();
            
        }
    });
        
        
    
    var config = {
        type: Phaser.AUTO,
        width: 512,
        height: 256,
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 0 }
            }
        },
        scene: [sceneOne,sceneTwo]
    };
    var game = new Phaser.Game(config);
    </script>

</body>
</html>