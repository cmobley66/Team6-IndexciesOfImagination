<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
</head>
<body>

    <script>
    
    var score = 9999;
    var scoreText;
    var enemiesLeft = "xx";
    var enemiesText;
    var gobmove =true;
    
    function bpress (){
        score -= 10;
        scoreText.setText('Time: ' + score);
        console.log(score)
        if(score <= 0){
            scoreText.setText('Click Screen: ' + score);
        }
    }
    function chealth(xmod,img,ymod = 8){
        health.create(256+xmod,ymod,img);
    }
    function cbar(xmod,ymod,img){
        platforms.create(256+xmod,128+ymod,img);
    }
    
    function zone(xpos,ypos){
        if(xpos > 224 && xpos <=240&&ypos > 96 && ypos <= 112){
            return "tl";
        }
        else if(xpos > 224 && xpos <=240&&ypos > 144 && ypos <= 160){
            return "bl";
        }
        else if(xpos > 272 && xpos <= 288&&ypos > 144 && ypos <= 160){
            return "br";
        }
        else if(xpos > 272 && xpos <= 288&&ypos > 96 && ypos <= 112){
            return "tr";
        }
            
               
        
        else if(xpos > 0 && xpos <= 208) {
            if(ypos > 0 && ypos <= 80){
                return 1;
            }
            else if(ypos > 80 && ypos <= 112){
                return 2;
            }
            else if(ypos > 112 && ypos <= 144){
                return 3;
            }
            else if(ypos > 144 && ypos <= 176){
                return 4;
            }
            else{
                return 5;
            }
        }
        else if(xpos > 208 && xpos <= 240){
            if(ypos > 0 && ypos <= 80){
                return 6;
            }
            
            else if(ypos > 112 && ypos <= 144){
                return 7;
            }
            
            else{
                return 8;
            }
        }
        else if(xpos > 240 && xpos <= 272){
            if(ypos > 0 && ypos <= 72){
                return 9;
            }
            else if(ypos > 80 && ypos <= 112){
                return 10;
            }
            else if(ypos > 112 && ypos <= 144){
                return 11;
            }
            else if(ypos > 144 && ypos <= 176){
                return 12;
            }
            else{
                return 13;
            }
        }
        else if(xpos > 272 && xpos <= 304){
            if(ypos > 0 && ypos <= 72){
                return 14;
            }
            
            else if(ypos > 112 && ypos <= 144){
                return 15;
            }
            
            else{
                return 16;
            }
        }
        else if(xpos > 304){
            if(ypos > 0 && ypos <= 80){
                return 17;
            }
            else if(ypos > 80 && ypos <= 112){
                return 18;
            }
            else if(ypos > 112 && ypos <= 144){
                return 19;
            }
            else if(ypos > 144 && ypos <= 176){
                return 20;
            }
            else{
                return 21;
            }
        }
        
    }
    var sceneOne = new Phaser.Class({
        Extends: Phaser.Scene,
        initialize:
        function SceneOne(){
            Phaser.Scene.call(this,{key: 'sceneOne'});
        },
        
        
    
        preload: function (){
            
            
            
            //images
            if (true){
                this.load.image('map1', 'enviormentAssets/tempmap1.png');
                this.load.image('fence1','enviormentAssets/fence_1.png');
                this.load.image('fence2','enviormentAssets/fence_2.png');
                this.load.image('fence3','enviormentAssets/fence_3.png');
                this.load.image('fence4','enviormentAssets/fence_4.png');
                this.load.image('fencetl','enviormentAssets/fence_tl.png');
                this.load.image('fencetr','enviormentAssets/fence_tr.png');
                this.load.image('fencebr','enviormentAssets/fence_bl.png');
                this.load.image('fencebl','enviormentAssets/fence_br.png');
                this.load.image('fheart','heart.png');
                this.load.image('gob','goblin.png')
                this.load.spritesheet('dude', 
                    './tempspritesheet.png',
                    { frameWidth: 16, frameHeight: 16 }
                    );
            }
            cursors = this.input.keyboard.createCursorKeys();
        
        },
        create: function (){   
            /*this.input.on('pointerdown', function (event) {
            if(score <= 0){
                console.log("thing");
                this.scene.start('sceneTwo'); 
            };
            
        }, this);*/
            this.add.image(256, 128, 'map1');
            scoreText = this.add.text(24, 0, 'Time: 9999', { fontSize: '16px', fill: '#FFF' });
            enemiesText = this.add.text(512-16*8, 0, 'Enemies: 24', { fontSize: '16px', fill: '#FFF' });

            goblin = this.physics.add.sprite(360, 0, 'gob');
            health = this.physics.add.staticGroup();
            var i = -3
            while(i<5){
                chealth(-8+16*i,'fheart');
                i += 1;
            }
            //load things
            if (true){
                platforms = this.physics.add.staticGroup();
                cbar(-40, -24, 'fence1');
                cbar(-40,-40, 'fencetl');
                cbar(-24, -40, 'fence4');

                cbar(40,-24, 'fence2')
                cbar(40, -40, 'fencetr');
                cbar(24, -40, 'fence4');

                cbar(-40, 24, 'fence1');
                cbar(-40, 40, 'fencebr');
                cbar(-24, 40, 'fence3');

                cbar(40,24, 'fence2');
                cbar(40, 40, 'fencebl');
                cbar(24, 40, 'fence3');
            }
            
            player = this.physics.add.sprite(360, 168, 'dude');
            
            player.setBounce(0.2);
            player.setCollideWorldBounds(true);
            goblin.setCollideWorldBounds(true);
            
            //player animation
            if(true){
                this.anims.create({
                    key: 'left',
                    frames: this.anims.generateFrameNumbers('dude', { start: 6, end: 8 }),
                    frameRate: 10,
                    repeat: -1
                });

                this.anims.create({
                    key: 'turn',
                    frames: [ { key: 'dude', frame: 4 } ],
                    frameRate: 10
                });

                this.anims.create({
                    key: 'right',
                    frames: this.anims.generateFrameNumbers('dude', { start: 9, end: 11 }),
                    frameRate: 10,
                    repeat: -1
                });
                this.anims.create({
                    key: 'up',
                    frames:  this.anims.generateFrameNumbers('dude', { start: 0, end: 2}),
                    frameRate: 10
                });
                this.anims.create({
                    key: 'down',
                    frames:  this.anims.generateFrameNumbers('dude', { start: 4, end: 5 }) ,
                    frameRate: 10
                });
            }

            this.physics.add.collider(player, platforms);
            this.physics.add.collider(player,goblin);
            this.physics.add.collider(platforms,goblin);
            
            //goblin.create(256,128,'fheart');
        
        },
        update: function (){
            
            scoreText = "Time:"+ Phaser.Timer;
            //player movement
            if (true){
                if((cursors.left.isDown && cursors.right.isUp) && (cursors.up.isDown && cursors.down.isUp)){
                    player.setVelocityX(-100);
                    player.setVelocityY(-100);
                    player.anims.play('left', true);
                }
                else if((cursors.left.isUp && cursors.right.isDown) && (cursors.up.isDown && cursors.down.isUp)){
                    player.setVelocityX(100);
                    player.setVelocityY(-100);
                    player.anims.play('right', true);
                }
                /*else if((cursors.left.isDown && cursors.right.isDown) && (cursors.up.isDown && cursors.down.isUp)){
                    player.setVelocityX(0);
                    player.setVelocityY(-100);
                    player.anims.play('right', true);
                }*/
                else if((cursors.left.isDown && cursors.right.isUp) && (cursors.up.isUp && cursors.down.isDown)){
                    player.setVelocityX(-100);
                    player.setVelocityY(100);
                    player.anims.play('left', true);
                }
                else if((cursors.left.isUp && cursors.right.isDown) && (cursors.up.isUp && cursors.down.isDown)){
                    player.setVelocityX(100);
                    player.setVelocityY(100);
                    player.anims.play('right', true);
                }
                else if (cursors.left.isDown){
                    player.setVelocityX(-100);
                    //bpress();

                    player.anims.play('left', true);
                }
                else if (cursors.right.isDown){
                    player.setVelocityX(100);
                    //bpress();
                    player.anims.play('right', true);
                }

                else if (cursors.up.isDown)
                {
                    player.setVelocityY(-100);
                    //bpress(player);
                    player.anims.play('up', true);
                }
                else if (cursors.down.isDown)
                {
                    player.setVelocityY(100);
                    //bpress(player);
                    player.anims.play('down', true);
                }
                else {
                    player.setVelocityY(0);
                    player.setVelocityX(0);
                }
            }
            if (true){
                if(cursors.space.isDown){
                    console.log("attack")
                }
            }
            //goblin movement
            playerzone = zone(player.body.position.x,goblin.body.position.y);
            gobzone = zone(goblin.body.position.x,goblin.body.position.y);
            //console.log("gob"+gobzone);
            if(true){
                if(playerzone == gobzone){
                    if (Math.abs(player.body.position.x - goblin.body.position.x)> Math.abs(player.body.position.y-goblin.body.position.y)){
                        if(player.body.position.x - goblin.body.position.x>0){
                            goblin.setVelocityX(100); 
                        }
                        else{
                            goblin.setVelocityX(-100);

                        }
                        goblin.setVelocityY(0);
                        
                    }
                    else if (Math.abs(player.body.position.x - goblin.body.position.x)< Math.abs(player.body.position.y-goblin.body.position.y)){
                        if(player.body.position.y - goblin.body.position.y>0){
                            goblin.setVelocityY(100);
                        }
                        else{
                            goblin.setVelocityY(-100);
                        }
                        goblin.setVelocityX(0);
                        gobmove = false;
                    }
                }
                else if(gobzone == "tl"){
                    goblin.setVelocityX(100);
                    goblin.setVelocityY(100);
                }
                else if(gobzone == "tr"){
                    goblin.setVelocityX(-100);
                    goblin.setVelocityY(100);
                }
                else if(gobzone == "bl"){
                    goblin.setVelocityX(100);
                    goblin.setVelocityY(-100);
                }
                else if(gobzone == "br"){
                    goblin.setVelocityX(-100);
                    goblin.setVelocityY(-100);
                }
                else if(gobzone == 1){
                    if(playerzone ==6||playerzone ==9||playerzone == 10||playerzone == 11||playerzone >=14){
                        goblin.setVelocityX(100);
                        goblin.setVelocityY(0);
                    }
                    else if(playerzone == 2||playerzone == 3||playerzone == 4||playerzone == 5|| playerzone == 7 ||playerzone == 8||playerzone == 12||playerzone == 13){
                        goblin.setVelocityX(0);
                        goblin.setVelocityY(100);
                    }
                }
                else if(gobzone == 2||gobzone == 10||gobzone == 18){
                    if(playerzone == 1||playerzone == 6||playerzone == 5||playerzone == 14||playerzone == 17){
                        goblin.setVelocityX(0);
                        goblin.setVelocityY(-100);
                    }
                    else{
                        goblin.setVelocityX(0);
                        goblin.setVelocityY(100);
                    }
                }
                else if(gobzone == 3){
                    if(playerzone > 5){
                        goblin.setVelocityX(0);
                        goblin.setVelocityY(100);
                    }
                    else if(playerzone == 2||playerzone == 1){
                        goblin.setVelocityX(-100);
                        goblin.setVelocityY(0);
                    }
                    else if(playerzone == 4||playerzone == 5){
                        goblin.setVelocityX(100);
                        goblin.setVelocityY(0);
                    }
                }
                else if(gobzone == 4||gobzone == 12||gobzone == 20){
                    if(playerzone == 5||playerzone == 8||playerzone == 13||playerzone == 16||playerzone == 21){
                        goblin.setVelocityX(0);
                        goblin.setVelocityY(-100);
                    }
                    else{
                        goblin.setVelocityX(0);
                        goblin.setVelocityY(100);
                    }
                }
                else if(gobzone == 5){
                    if(playerzone ==1||playerzone ==2||playerzone ==3||playerzone ==4||playerzone ==6||playerzone ==7||playerzone ==9||playerzone ==10||playerzone ==11||playerzone ==14||playerzone ==15||playerzone ==17||playerzone ==18||playerzone ==19||playerzone ==20){
                        goblin.setVelocityX(-100);
                        goblin.setVelocityY(0)
                    }
                    if(playerzone ==8|playerzone ==12||playerzone == 13||playerzone ==16||playerzone ==21){
                        goblin.setVelocityX(0)
                        goblin.setVelocityY(100);
                    }
                    
                        
                }
                else if(gobzone == 6||gobzone ==7||gobzone ==8){
                    if(playerzone <=5){
                        goblin.setVelocityX(-100);
                        goblin.setVelocityY(0);
                    }
                    else{
                     goblin.setVelocityX(100);
                        goblin.setVelocityY(0);
                    }
                }
                else if(gobzone == 9){
                    
                }
                else if(gobzone == 11){
                    if(playerzone <=5|| playerzone == 7){
                        goblin.setVelocityX(-100);
                        goblin.setVelocityY(0)
                    }
                    else if(playerzone >= 17|| playerzone == 15){
                        goblin.setVelocityX(100);
                        goblin.setVelocityY(0)
                    }
                    else if(playerzone == 6||playerzone == 9||playerzone == 10||playerzone ==14){
                        goblin.setVelocityX(0);
                        goblin.setVelocityY(-100)
                    }
                    else if(playerzone == 8||playerzone == 12||playerzone == 13||playerzone ==16){
                        goblin.setVelocityX(0);
                        goblin.setVelocityY(100)
                    }
                }
                else if(gobzone == 13){
                    if(playerzone <= 5){
                        goblin.setVelocityX(-100);
                        goblin.setVelocityY(0)
                    }
                    else if(playerzone >=17){
                        goblin.setVelocityX(100);
                        goblin.setVelocityY(0)
                    }
                    else{
                        goblin.setVelocityX(0);
                        goblin.setVelocityY(-100)
                    }
                }
                else if(gobzone == 14||gobzone ==15||gobzone ==16){
                    if(playerzone >=17){
                        goblin.setVelocityX(100);
                        goblin.setVelocityY(0);
                    }
                    else{
                     goblin.setVelocityX(-100);
                        goblin.setVelocityY(0);
                    }
                }
                else if(gobzone == 17){
                    if(playerzone >= 15){
                        goblin.setVelocityX(0);
                        goblin.setVelocityY(100);
                    }
                    else{
                        goblin.setVelocityX(-100);
                        goblin.setVelocityY(0)
                    }
                }
                else if(gobzone ==19){
                    if(playerzone == 17|| playerzone == 18||playerzone == 14){
                        goblin.setVelocityX(0);
                        goblin.setVelocityY(-100);
                    }
                    else if(playerzone == 20||playerzone == 21||playerzone ==16){
                        goblin.setVelocityX(0);
                        goblin.setVelocityY(100);
                    }
                    else{
                        goblin.setVelocityX(-100);
                        goblin.setVelocityY(0);
                    }
                }
                else if(gobzone == 21){
                    if(playerzone >= 17||playerzone == 14|| playerzone == 15){
                        goblin.setVelocityX(0);
                        goblin.setVelocityY(-100);
                    }
                    else{
                        goblin.setVelocityX(-100);
                        goblin.setVelocityY(0);
                    }
                }
            }
            
            
                
            
        }
        
        
    });
    
    var sceneTwo = new Phaser.Class({
        Extends: Phaser.Scene,
        initialize:
        function sceneTwo(){
            Phaser.Scene.call(this,{key:'sceneTwo'});
        },
        preload: function(){
            this.load.image('bg', 'ladyelaine.png');
            
        },
        create: function(){
            this.add.image(400, 300, 'bg').setScale(.25);
            scoreText = this.add.text(16, 16, 'Jump: 9999', { fontSize: '32px', fill: '#183' });
            gametext = this.add.text(50, 300, 'the game is over there is nothing left', { fontSize: '32px', fill: '#30a' });
        },
        update: function(){
            bpress();
            
        }
    });
        
        
    
    var config = {
        type: Phaser.AUTO,
        width: 512,
        height: 256,
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 0 }
            }
        },
        scene: [sceneOne,sceneTwo]
    };
    var game = new Phaser.Game(config);
    </script>

</body>
</html>